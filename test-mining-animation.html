<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Umbrella Mines - Retro Mining Animation Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(180deg, #0a0e27 0%, #1a0a2e 50%, #0a0e27 100%);
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* Neon Title */
        .neon-title {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .neon-title h1 {
            margin: 0;
            font-size: 48px;
            font-weight: bold;
            letter-spacing: 8px;
            color: #00ff41;
            text-shadow:
                0 0 10px #00ff41,
                0 0 20px #00ff41,
                0 0 30px #00ff41,
                0 0 40px #00ff41,
                0 0 70px #00ff41,
                0 0 80px #00ff41;
            animation: flicker 3s infinite alternate;
        }

        .subtitle {
            margin: 10px 0 0 0;
            font-size: 18px;
            letter-spacing: 4px;
            color: #00d4ff;
            text-shadow:
                0 0 5px #00d4ff,
                0 0 10px #00d4ff,
                0 0 15px #00d4ff,
                0 0 20px #00d4ff;
        }

        .umbrella-float {
            font-size: 42px;
            display: inline-block;
            color: #00ff41;
            text-shadow:
                0 0 10px #00ff41,
                0 0 20px #00ff41,
                0 0 30px #00ff41;
            animation: float 3s ease-in-out infinite;
            margin: 0 15px;
        }

        .snake-icon {
            display: inline-block;
            width: 42px;
            height: 42px;
            vertical-align: middle;
            margin: 0 15px;
            animation: float 3s ease-in-out infinite;
            filter: drop-shadow(0 0 10px #ff3333) drop-shadow(0 0 20px #ff3333);
        }

        @keyframes flicker {
            0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
                text-shadow:
                    0 0 10px #00ff41,
                    0 0 20px #00ff41,
                    0 0 30px #00ff41,
                    0 0 40px #00ff41,
                    0 0 70px #00ff41,
                    0 0 80px #00ff41;
            }
            20%, 24%, 55% {
                text-shadow:
                    0 0 5px #00ff41,
                    0 0 10px #00ff41;
            }
        }

        @keyframes flicker-viper {
            0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
                text-shadow:
                    0 0 10px #ff3333,
                    0 0 20px #ff3333,
                    0 0 30px #ff3333,
                    0 0 40px #ff3333,
                    0 0 70px #ff3333,
                    0 0 80px #ff3333;
            }
            20%, 24%, 55% {
                text-shadow:
                    0 0 5px #ff3333,
                    0 0 10px #ff3333;
            }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(5deg); }
            50% { transform: translateY(-10px) rotate(-5deg); }
        }

        /* Page-wide firework particles */
        .page-firework {
            position: fixed;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            box-shadow: 0 0 20px currentColor;
            transition: all 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes page-firework-fade {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.3);
            }
        }

        .mining-container {
            display: flex;
            gap: 20px;
            max-width: 1240px;
            width: 100%;
            padding: 0 10px;
            box-sizing: border-box;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .mining-container {
                flex-direction: column;
                gap: 15px;
                padding: 0 5px;
            }

            .neon-title h1 {
                font-size: 28px;
                letter-spacing: 4px;
            }

            .neon-title .subtitle {
                font-size: 14px;
                letter-spacing: 2px;
            }

            .umbrella-float {
                font-size: 24px;
                margin: 0 8px;
            }

            .crt-monitor {
                width: 100%;
                max-width: 500px;
                height: auto;
                padding: 15px;
                margin: 0 auto;
            }

            .screen {
                height: 400px;
            }

            #animation-canvas {
                width: 100%;
                height: 100%;
            }

            .monitor-header {
                font-size: 12px;
                letter-spacing: 1px;
            }

            .status-bar {
                font-size: 10px;
                padding: 6px 8px;
            }

            .terminal-output {
                font-size: 11px;
                padding: 10px;
            }

            .toggle-container {
                max-width: 350px;
                padding: 15px;
            }

            .toggle-switch {
                width: 180px;
                height: 70px;
            }

            .toggle-switch::before,
            .toggle-switch::after {
                font-size: 11px;
            }

            .toggle-slider {
                width: 70px;
                height: 52px;
            }

            body.viper-mode .toggle-slider {
                left: 98px;
            }
        }

        /* Very small mobile */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .neon-title h1 {
                font-size: 22px;
                letter-spacing: 2px;
            }

            .neon-title .subtitle {
                font-size: 12px;
            }

            .umbrella-float {
                font-size: 20px;
                margin: 0 5px;
            }

            .crt-monitor {
                padding: 10px;
            }

            .screen {
                height: 300px;
            }

            .monitor-header {
                font-size: 11px;
                margin-bottom: 10px;
            }

            .terminal-output {
                font-size: 10px;
                line-height: 1.4;
            }

            .toggle-container {
                max-width: 300px;
                padding: 12px;
            }

            .toggle-label {
                font-size: 12px;
                margin-bottom: 12px;
            }

            .toggle-switch {
                width: 160px;
                height: 60px;
            }

            .toggle-switch::before {
                left: 8px;
                font-size: 10px;
            }

            .toggle-switch::after {
                right: 8px;
                font-size: 10px;
            }

            .toggle-slider {
                width: 60px;
                height: 44px;
                left: 6px;
                top: 6px;
            }

            body.viper-mode .toggle-slider {
                left: 90px;
            }
        }

        .crt-monitor {
            width: 600px;
            height: 600px;
            background: linear-gradient(145deg, #1a1f3a 0%, #0f1429 100%);
            border: 3px solid #00ff41;
            border-radius: 12px;
            padding: 20px;
            box-shadow:
                0 0 30px rgba(0, 255, 65, 0.5),
                0 0 60px rgba(0, 255, 65, 0.3),
                inset 0 0 20px rgba(0, 0, 0, 0.5);
            position: relative;
            animation: pulse-glow 2s ease-in-out infinite alternate;
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 0 30px rgba(0, 255, 65, 0.5), 0 0 60px rgba(0, 255, 65, 0.3), inset 0 0 20px rgba(0, 0, 0, 0.5); }
            100% { box-shadow: 0 0 40px rgba(0, 255, 65, 0.7), 0 0 80px rgba(0, 255, 65, 0.4), inset 0 0 20px rgba(0, 0, 0, 0.5); }
        }

        @keyframes glitch-shake {
            0% { transform: translate(0, 0) rotate(0deg); }
            10% { transform: translate(-5px, 2px) rotate(-2deg); }
            20% { transform: translate(3px, -3px) rotate(1deg); }
            30% { transform: translate(-2px, 4px) rotate(-1deg); }
            40% { transform: translate(4px, -2px) rotate(2deg); }
            50% { transform: translate(-3px, 3px) rotate(-1deg); }
            60% { transform: translate(2px, -4px) rotate(1deg); }
            70% { transform: translate(-4px, 1px) rotate(-2deg); }
            80% { transform: translate(3px, -1px) rotate(1deg); }
            90% { transform: translate(-1px, 2px) rotate(-1deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        .crt-monitor.glitching {
            animation: glitch-shake 0.3s ease-in-out;
        }

        .crt-monitor::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                rgba(18, 16, 16, 0) 50%,
                rgba(0, 0, 0, 0.25) 50%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 10;
        }

        .monitor-header {
            text-align: center;
            color: #00ff41;
            font-size: 14px;
            letter-spacing: 2px;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
        }

        .screen {
            width: 100%;
            height: 520px;
            background: #000;
            border: 2px solid #00ff41;
            position: relative;
            overflow: hidden;
        }

        /* Animation Canvas */
        #animation-canvas {
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        /* Terminal Output */
        .terminal-output {
            width: 100%;
            height: 100%;
            padding: 15px;
            color: #00ff41;
            font-size: 13px;
            line-height: 1.6;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
        }

        .terminal-output::-webkit-scrollbar {
            width: 8px;
        }

        .terminal-output::-webkit-scrollbar-track {
            background: #0a0e27;
        }

        .terminal-output::-webkit-scrollbar-thumb {
            background: #00ff41;
            border-radius: 4px;
        }

        .terminal-line {
            margin: 2px 0;
        }

        .hash-rate {
            color: #00d4ff;
        }

        .solution-found {
            color: #ffff00;
            font-weight: bold;
            animation: blink 0.5s ease-in-out 3;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .status-bar {
            margin-top: 10px;
            padding: 8px 12px;
            background: rgba(0, 255, 65, 0.1);
            border: 1px solid #00ff41;
            border-radius: 4px;
            color: #00ff41;
            font-size: 11px;
            letter-spacing: 1px;
            text-align: center;
        }

        /* Toggle Switch Container */
        .toggle-container {
            margin-top: 30px;
            text-align: center;
            padding: 20px;
            background: linear-gradient(145deg, #1a1f3a 0%, #0f1429 100%);
            border: 3px solid #00ff41;
            border-radius: 12px;
            max-width: 400px;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
        }

        .toggle-label {
            color: #00ff41;
            font-size: 14px;
            letter-spacing: 2px;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
        }

        /* Old School Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 200px;
            height: 80px;
            background: linear-gradient(145deg, #2a2a2a 0%, #1a1a1a 100%);
            border: 4px solid #444;
            border-radius: 12px;
            box-shadow:
                inset 0 2px 5px rgba(0, 0, 0, 0.5),
                0 0 10px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            overflow: hidden;
        }

        .toggle-switch::before {
            content: 'UMBRELLA';
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #00ff41;
            font-size: 12px;
            font-weight: bold;
            letter-spacing: 1px;
            text-shadow: 0 0 8px #00ff41;
            transition: all 0.3s;
        }

        .toggle-switch::after {
            content: 'VIPER';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-size: 12px;
            font-weight: bold;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        .toggle-slider {
            position: absolute;
            top: 8px;
            left: 8px;
            width: 80px;
            height: 60px;
            background: linear-gradient(145deg, #00ff41 0%, #00cc33 100%);
            border: 3px solid #00ff41;
            border-radius: 8px;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow:
                0 4px 8px rgba(0, 0, 0, 0.4),
                inset 0 1px 3px rgba(255, 255, 255, 0.3),
                0 0 15px rgba(0, 255, 65, 0.6);
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 40px;
            background: linear-gradient(145deg, #00aa2a 0%, #008822 100%);
            border-radius: 4px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Viper Mode Active */
        body.viper-mode .toggle-switch::before {
            color: #666;
            text-shadow: none;
        }

        body.viper-mode .toggle-switch::after {
            color: #ff3333;
            text-shadow: 0 0 8px #ff3333;
        }

        body.viper-mode .toggle-slider {
            left: 108px;
            background: linear-gradient(145deg, #ff3333 0%, #cc0000 100%);
            border-color: #ff3333;
            box-shadow:
                0 4px 8px rgba(0, 0, 0, 0.4),
                inset 0 1px 3px rgba(255, 255, 255, 0.3),
                0 0 15px rgba(255, 51, 51, 0.6);
        }

        body.viper-mode .toggle-slider::before {
            background: linear-gradient(145deg, #aa0000 0%, #880000 100%);
        }

        /* Viper Mode Theme Overrides */
        body.viper-mode {
            background: linear-gradient(180deg, #2a0a0a 0%, #1a0a00 50%, #2a0a0a 100%);
        }

        body.viper-mode .neon-title h1 {
            color: #ff3333;
            animation: flicker-viper 3s infinite alternate;
        }

        body.viper-mode .subtitle {
            color: #ffaa00;
            text-shadow:
                0 0 5px #ffaa00,
                0 0 10px #ffaa00,
                0 0 15px #ffaa00,
                0 0 20px #ffaa00;
        }

        body.viper-mode .umbrella-float {
            font-family: monospace;
            font-weight: bold;
            color: #ff3333;
            text-shadow:
                0 0 10px #ff3333,
                0 0 20px #ff3333,
                0 0 30px #ff3333;
        }

        body.viper-mode .crt-monitor {
            border-color: #ff3333;
            box-shadow:
                0 0 30px rgba(255, 51, 51, 0.5),
                0 0 60px rgba(255, 51, 51, 0.3),
                inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        body.viper-mode .screen {
            border-color: #ff3333;
        }

        body.viper-mode .monitor-header,
        body.viper-mode .status-bar {
            color: #ff3333;
            border-color: #ff3333;
            background: rgba(255, 51, 51, 0.1);
            text-shadow: 0 0 10px rgba(255, 51, 51, 0.5);
        }

        body.viper-mode .terminal-output {
            color: #ff3333;
        }

        body.viper-mode .hash-rate {
            color: #ffaa00;
        }

        body.viper-mode .solution-found {
            color: #ffff00;
        }

        body.viper-mode .toggle-container {
            border-color: #ff3333;
            box-shadow: 0 0 20px rgba(255, 51, 51, 0.3);
        }

        body.viper-mode .toggle-label {
            color: #ff3333;
            text-shadow: 0 0 10px rgba(255, 51, 51, 0.5);
        }

        @keyframes pulse-glow-viper {
            0% { box-shadow: 0 0 30px rgba(255, 51, 51, 0.5), 0 0 60px rgba(255, 51, 51, 0.3), inset 0 0 20px rgba(0, 0, 0, 0.5); }
            100% { box-shadow: 0 0 40px rgba(255, 51, 51, 0.7), 0 0 80px rgba(255, 51, 51, 0.4), inset 0 0 20px rgba(0, 0, 0, 0.5); }
        }

        body.viper-mode .crt-monitor {
            animation: pulse-glow-viper 2s ease-in-out infinite alternate;
        }
    </style>
</head>
<body>
    <!-- Neon Title Header -->
    <div class="neon-title">
        <h1>
            <span class="umbrella-float" id="icon-left">☂</span>
            <canvas id="snake-left" class="snake-icon" width="42" height="42" style="display:none;"></canvas>
            <span id="title-text">UMBRELLA MINES</span>
            <span class="umbrella-float" id="icon-right">☂</span>
            <canvas id="snake-right" class="snake-icon" width="42" height="42" style="display:none;"></canvas>
        </h1>
        <p class="subtitle" id="subtitle-text">NIGHT MINER</p>
    </div>

    <div class="mining-container">
        <!-- Animation Monitor -->
        <div class="crt-monitor">
            <div class="monitor-header">MINING ANIMATION</div>
            <div class="screen">
                <canvas id="animation-canvas"></canvas>
            </div>
            <div class="status-bar">PICKAXE MINING ACTIVE</div>
        </div>

        <!-- Terminal Monitor -->
        <div class="crt-monitor">
            <div class="monitor-header">LIVE MINING STREAM</div>
            <div class="screen">
                <div class="terminal-output" id="terminal"></div>
            </div>
            <div class="status-bar" id="status">INITIALIZING MINER...</div>
        </div>
    </div>

    <!-- Toggle Switch -->
    <div class="toggle-container">
        <div class="toggle-label">MODE SELECT</div>
        <div class="toggle-switch" id="mode-toggle">
            <div class="toggle-slider"></div>
        </div>
    </div>

    <script>
        // Pixel Art Mining Animation
        const canvas = document.getElementById('animation-canvas');
        const ctx = canvas.getContext('2d');

        // Set canvas size responsively
        function resizeCanvas() {
            const container = canvas.parentElement;
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;

            // Maintain aspect ratio
            const aspectRatio = 560 / 520;

            if (containerWidth / containerHeight > aspectRatio) {
                canvas.height = containerHeight;
                canvas.width = containerHeight * aspectRatio;
            } else {
                canvas.width = containerWidth;
                canvas.height = containerWidth / aspectRatio;
            }
        }

        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Draw pixel snake icon
        function drawPixelSnake(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, 42, 42);

            // Pixel snake (like old school snake game)
            ctx.fillStyle = '#ff3333';

            // Snake body segments (S-curve)
            // Head (top)
            ctx.fillRect(18, 6, 6, 6);
            // Tongue
            ctx.fillRect(21, 3, 2, 3);
            ctx.fillRect(19, 3, 2, 3);

            // Body segments
            ctx.fillRect(18, 12, 6, 6);
            ctx.fillRect(12, 12, 6, 6);
            ctx.fillRect(12, 18, 6, 6);
            ctx.fillRect(18, 18, 6, 6);
            ctx.fillRect(24, 18, 6, 6);
            ctx.fillRect(24, 24, 6, 6);
            ctx.fillRect(18, 24, 6, 6);
            ctx.fillRect(18, 30, 6, 6);

            // Eyes
            ctx.fillStyle = '#000';
            ctx.fillRect(19, 7, 2, 2);
            ctx.fillRect(23, 7, 2, 2);
        }

        // Mode Toggle Handler
        let isViperMode = false;

        document.getElementById('mode-toggle').addEventListener('click', function() {
            isViperMode = !isViperMode;

            if (isViperMode) {
                // Switch to Viper Mode
                document.body.classList.add('viper-mode');
                document.getElementById('title-text').textContent = 'VIPER MINES';
                document.getElementById('subtitle-text').textContent = 'VENOM PROTOCOL';

                // Show snake icons
                document.getElementById('icon-left').style.display = 'none';
                document.getElementById('icon-right').style.display = 'none';
                document.getElementById('snake-left').style.display = 'inline-block';
                document.getElementById('snake-right').style.display = 'inline-block';
                drawPixelSnake('snake-left');
                drawPixelSnake('snake-right');
            } else {
                // Switch to Umbrella Mode
                document.body.classList.remove('viper-mode');
                document.getElementById('title-text').textContent = 'UMBRELLA MINES';
                document.getElementById('subtitle-text').textContent = 'NIGHT MINER';

                // Show umbrella icons
                document.getElementById('icon-left').style.display = 'inline-block';
                document.getElementById('icon-right').style.display = 'inline-block';
                document.getElementById('snake-left').style.display = 'none';
                document.getElementById('snake-right').style.display = 'none';
            }
        });

        // Animation state
        let frame = 0;
        let pickaxeAngle = 0;
        let isSwinging = false;
        let swingProgress = 0;
        let particles = [];
        let totalSwings = 0;
        let swingsSinceBlock = 0;
        let swingsSinceGlitch = 0;
        let nextGlitchAt = Math.floor(Math.random() * 40) + 80; // Random between 80-120 swings

        // Floppy disk position (center of screen)
        const diskX = canvas.width / 2;
        const diskY = canvas.height / 2 + 50;

        // Particle class
        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 8;
                this.vy = (Math.random() - 0.5) * 8 - 4;
                this.life = 30;
                this.size = Math.random() * 4 + 2;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.3; // gravity
                this.life--;
            }

            draw() {
                const color = isViperMode ? '255, 51, 51' : '0, 255, 65';
                ctx.fillStyle = `rgba(${color}, ${this.life / 30})`;
                ctx.fillRect(Math.floor(this.x), Math.floor(this.y), this.size, this.size);
            }
        }

        // Firework particle for solutions found
        class Firework {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 10 + 6;
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
                this.life = 50;
                this.maxLife = 50;
                this.size = Math.random() * 5 + 3;
                // Different colors for each mode
                const umbrellaColors = ['#00ff41', '#00d4ff', '#ffff00', '#ff00ff', '#ff8800'];
                const viperColors = ['#ff3333', '#ffaa00', '#ffff00', '#ffffff', '#ff8800'];
                const colors = isViperMode ? viperColors : umbrellaColors;
                this.color = colors[Math.floor(Math.random() * colors.length)];
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vx *= 0.97; // air resistance
                this.vy += 0.3; // gravity
                this.life--;
            }

            draw() {
                const opacity = this.life / this.maxLife;
                ctx.fillStyle = `rgba(${parseInt(this.color.slice(1,3), 16)}, ${parseInt(this.color.slice(3,5), 16)}, ${parseInt(this.color.slice(5,7), 16)}, ${opacity})`;

                // Glow effect
                ctx.shadowBlur = 15;
                ctx.shadowColor = this.color;
                ctx.fillRect(Math.floor(this.x), Math.floor(this.y), this.size, this.size);
                ctx.shadowBlur = 0;
            }
        }

        let fireworks = [];

        // Draw pixelated floppy disk (actual 3.5" disk style)
        function drawFloppyDisk(x, y, hit = false) {
            const scale = 3;
            const offsetY = hit ? 2 : 0; // Shake on hit

            // Main disk body (black plastic)
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(x - 20 * scale, y - 25 * scale + offsetY, 40 * scale, 50 * scale);

            // Disk outline
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.strokeRect(x - 20 * scale, y - 25 * scale + offsetY, 40 * scale, 50 * scale);

            // Metal shutter (top, sliding part)
            ctx.fillStyle = '#888';
            ctx.fillRect(x - 18 * scale, y - 20 * scale + offsetY, 36 * scale, 12 * scale);

            // Shutter detail lines
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(x - 18 * scale, y - 14 * scale + offsetY);
            ctx.lineTo(x + 18 * scale, y - 14 * scale + offsetY);
            ctx.stroke();

            // Label area (white sticker)
            ctx.fillStyle = '#e0e0e0';
            ctx.fillRect(x - 16 * scale, y - 2 * scale + offsetY, 32 * scale, 20 * scale);

            // Label border
            ctx.strokeStyle = '#999';
            ctx.lineWidth = 1;
            ctx.strokeRect(x - 16 * scale, y - 2 * scale + offsetY, 32 * scale, 20 * scale);

            // Label text
            ctx.fillStyle = '#000';
            ctx.font = 'bold 14px monospace';
            ctx.fillText('NIGHT', x - 24, y + 12 + offsetY);

            // Write protect notch (bottom right)
            ctx.fillStyle = '#000';
            ctx.fillRect(x + 12 * scale, y + 20 * scale + offsetY, 6 * scale, 4 * scale);

            // Hub hole (center circle for the magnetic disk)
            ctx.fillStyle = '#444';
            ctx.beginPath();
            ctx.arc(x, y - 12 * scale + offsetY, 4 * scale, 0, Math.PI * 2);
            ctx.fill();
        }

        // Draw pixelated pickaxe (Minecraft style)
        function drawPickaxe(x, y, angle) {
            ctx.save();

            // Rotate around the BOTTOM of handle (where hand/wrist grips)
            ctx.translate(x, y);
            ctx.rotate(angle);

            const scale = 3;
            const handleLength = 35 * scale;

            // Handle (wooden brown) - extends UP from rotation point (bottom of handle)
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(-2 * scale, -handleLength, 4 * scale, handleLength);

            // Handle grip detail (darker) - near the bottom where hand is
            ctx.fillStyle = '#6B3410';
            ctx.fillRect(-2 * scale, -10 * scale, 4 * scale, 3 * scale);
            ctx.fillRect(-2 * scale, -20 * scale, 4 * scale, 3 * scale);

            // Pick head mounting (dark metal) - at TOP of handle
            ctx.fillStyle = '#333';
            ctx.fillRect(-3 * scale, -handleLength - 3 * scale, 6 * scale, 6 * scale);

            // Left curved pick (pointed) - extends LEFT from head
            ctx.fillStyle = '#777';
            // Thick part
            ctx.fillRect(-16 * scale, -handleLength - 2 * scale, 13 * scale, 4 * scale);
            // Taper to point
            ctx.fillRect(-18 * scale, -handleLength - 1 * scale, 2 * scale, 2 * scale);
            // Point
            ctx.fillRect(-20 * scale, -handleLength, 2 * scale, 1 * scale);

            // Right curved pick (pointed) - extends RIGHT from head
            ctx.fillStyle = '#777';
            // Thick part
            ctx.fillRect(3 * scale, -handleLength - 2 * scale, 13 * scale, 4 * scale);
            // Taper to point
            ctx.fillRect(16 * scale, -handleLength - 1 * scale, 2 * scale, 2 * scale);
            // Point
            ctx.fillRect(18 * scale, -handleLength, 2 * scale, 1 * scale);

            // Metal highlights (light gray on top edge)
            ctx.fillStyle = '#999';
            ctx.fillRect(-16 * scale, -handleLength - 2 * scale, 13 * scale, 1 * scale);
            ctx.fillRect(3 * scale, -handleLength - 2 * scale, 13 * scale, 1 * scale);

            // Pick point highlights
            ctx.fillStyle = '#aaa';
            ctx.fillRect(-18 * scale, -handleLength - 1 * scale, 2 * scale, 1 * scale);
            ctx.fillRect(16 * scale, -handleLength - 1 * scale, 2 * scale, 1 * scale);

            ctx.restore();
        }

        // Animation loop
        function animate() {
            // Clear canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw floppy disk
            const isHit = swingProgress > 0.7 && swingProgress < 0.8;
            drawFloppyDisk(diskX, diskY, isHit);

            // Swing animation
            if (!isSwinging) {
                // Start new swing every 60 frames
                if (frame % 60 === 0) {
                    isSwinging = true;
                    swingProgress = 0;
                }
            } else {
                swingProgress += 0.05;

                // Create particles when hitting
                if (swingProgress > 0.7 && swingProgress < 0.75) {
                    swingsSinceBlock++;
                    totalSwings++;
                    swingsSinceGlitch++;

                    // Check for glitch event
                    if (swingsSinceGlitch >= nextGlitchAt) {
                        const monitor = document.querySelector('.crt-monitor');
                        monitor.classList.add('glitching');
                        setTimeout(() => {
                            monitor.classList.remove('glitching');
                        }, 300);

                        swingsSinceGlitch = 0;
                        nextGlitchAt = Math.floor(Math.random() * 40) + 80; // Next glitch in 80-120 swings
                    }

                    // 5% chance for NICE block hit
                    const isNiceBlock = Math.random() < 0.05;
                    const particleCount = isNiceBlock ? 69 : 5;

                    for (let i = 0; i < particleCount; i++) {
                        particles.push(new Particle(diskX, diskY - 40));
                    }

                    // Reset swings counter on nice block
                    if (isNiceBlock) {
                        swingsSinceBlock = 0;
                    }
                }

                if (swingProgress >= 1) {
                    isSwinging = false;
                    swingProgress = 0;
                }
            }

            // Calculate pickaxe position and angle
            if (isSwinging) {
                // Swing arc from top-right to bottom (hitting disk)
                const t = swingProgress;
                pickaxeAngle = -Math.PI / 4 + (Math.PI / 2) * t;
            } else {
                // Return to starting position
                pickaxeAngle = -Math.PI / 4;
            }

            // Pickaxe position (above and to the right of disk)
            const pickX = diskX + 120;
            const pickY = diskY - 60;

            // Draw pickaxe
            drawPickaxe(pickX, pickY, pickaxeAngle);

            // Update and draw particles
            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => {
                p.update();
                p.draw();
            });

            // Update and draw fireworks
            fireworks = fireworks.filter(f => f.life > 0);
            fireworks.forEach(f => {
                f.update();
                f.draw();
            });

            // Stats overlay
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(10, 10, 260, 160);

            // Different colors for different modes
            const primaryColor = isViperMode ? '#ff3333' : '#00ff41';
            const secondaryColor = isViperMode ? '#ffaa00' : '#00d4ff';

            ctx.strokeStyle = primaryColor;
            ctx.lineWidth = 2;
            ctx.strokeRect(10, 10, 260, 160);

            ctx.fillStyle = primaryColor;
            ctx.font = 'bold 12px monospace';
            ctx.fillText('MINING STATS', 20, 30);

            ctx.font = '11px monospace';
            ctx.fillText(`Total Swings: ${totalSwings.toLocaleString()}`, 20, 50);
            ctx.fillText(`Swings Until Block: ${swingsSinceBlock}`, 20, 70);
            ctx.fillText(`Particles: ${particles.length}`, 20, 90);

            // Mock stats (will be real data later)
            ctx.fillStyle = secondaryColor;
            ctx.fillText(`Wallets: 42`, 20, 115);
            ctx.fillText(`Solutions: 13`, 20, 135);
            ctx.fillText(`NIGHT Earned: 0.420000`, 20, 155);

            frame++;
            requestAnimationFrame(animate);
        }

        // Terminal simulation
        const terminal = document.getElementById('terminal');
        const statusBar = document.getElementById('status');
        let hashCount = 0;
        let solutionCount = 0;

        function addTerminalLine(text, className = '') {
            const line = document.createElement('div');
            line.className = `terminal-line ${className}`;
            line.textContent = text;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;

            // Keep only last 50 lines
            while (terminal.children.length > 50) {
                terminal.removeChild(terminal.firstChild);
            }
        }

        function simulateMining() {
            // Random hash updates
            setInterval(() => {
                hashCount += Math.floor(Math.random() * 100) + 50;
                const hashRate = Math.floor(Math.random() * 200) + 800;
                addTerminalLine(`[${new Date().toLocaleTimeString()}] Hashes: ${hashCount.toLocaleString()} | Rate: ${hashRate} H/s`, 'hash-rate');

                statusBar.textContent = `MINING ACTIVE | ${hashRate} H/s | ${solutionCount} SOLUTIONS`;
            }, 2000);

            // Random solution found
            setInterval(() => {
                if (Math.random() > 0.7) {
                    solutionCount++;
                    const nonce = Math.floor(Math.random() * 999999);
                    addTerminalLine(`>>> SOLUTION FOUND! Nonce: ${nonce} <<<`, 'solution-found');
                    addTerminalLine(`Submitting to Midnight Scavenger API...`);
                    setTimeout(() => {
                        addTerminalLine(`Solution submitted successfully!`);
                    }, 1000);

                    // TRIGGER FIREWORKS ON ANIMATION!
                    triggerFireworks();
                }
            }, 8000);

            // Function to trigger fireworks
            function triggerFireworks() {
                // Launch 100 firework particles from center of canvas
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;

                for (let i = 0; i < 100; i++) {
                    fireworks.push(new Firework(centerX, centerY));
                }

                // 30% chance to also trigger page-wide fireworks!
                if (Math.random() < 0.3) {
                    triggerPageFireworks();
                }
            }

            // Create page-wide fireworks that escape the monitors
            function triggerPageFireworks() {
                const umbrellaColors = ['#00ff41', '#00d4ff', '#ffff00', '#ff00ff', '#ff8800'];
                const viperColors = ['#ff3333', '#ffaa00', '#ffff00', '#ffffff', '#ff8800'];
                const colors = isViperMode ? viperColors : umbrellaColors;
                const numParticles = Math.floor(Math.random() * 30) + 40; // 40-70 particles

                for (let i = 0; i < numParticles; i++) {
                    // Random starting position across the viewport
                    const startX = Math.random() * window.innerWidth;
                    const startY = Math.random() * window.innerHeight;

                    // Random end position (fly outward from center)
                    const centerX = window.innerWidth / 2;
                    const centerY = window.innerHeight / 2;
                    const angle = Math.atan2(startY - centerY, startX - centerX);
                    const distance = Math.random() * 300 + 200; // Fly 200-500px
                    const endX = startX + Math.cos(angle) * distance;
                    const endY = startY + Math.sin(angle) * distance + Math.random() * 200; // Add gravity

                    // Create particle element
                    const particle = document.createElement('div');
                    particle.className = 'page-firework';
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    particle.style.backgroundColor = color;
                    particle.style.left = startX + 'px';
                    particle.style.top = startY + 'px';
                    particle.style.width = (Math.random() * 6 + 4) + 'px';
                    particle.style.height = particle.style.width;

                    document.body.appendChild(particle);

                    // Trigger animation
                    setTimeout(() => {
                        particle.style.left = endX + 'px';
                        particle.style.top = endY + 'px';
                        particle.style.opacity = '0';
                        particle.style.transform = 'scale(0.3)';
                    }, 10);

                    // Remove after animation
                    setTimeout(() => {
                        particle.remove();
                    }, 1600);
                }
            }

            // Initial messages
            addTerminalLine('=================================');
            addTerminalLine('UMBRELLA MINES MINER v0.3.1');
            addTerminalLine('=================================');
            addTerminalLine('Initializing AshMaize FFI...');
            setTimeout(() => {
                addTerminalLine('Generating ephemeral wallet...');
                statusBar.textContent = 'GENERATING WALLET...';
            }, 500);
            setTimeout(() => {
                addTerminalLine('Wallet created: addr1qx...');
                addTerminalLine('Fetching current challenge...');
                statusBar.textContent = 'FETCHING CHALLENGE...';
            }, 1000);
            setTimeout(() => {
                addTerminalLine('Challenge: 00000abc... | Difficulty: 20');
                addTerminalLine('Starting mining...');
                statusBar.textContent = 'MINING ACTIVE | 0 H/s | 0 SOLUTIONS';
            }, 1500);
        }

        // Start animations
        animate();
        simulateMining();
    </script>
</body>
</html>
